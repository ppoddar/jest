<project name="tomcat" default="deploy">

	<property file="build.properties"></property>

	<!-- Tomcat Deployment -->
	
	<path id="catalina-ant-classpath">
		<pathelement path="${basedir}"/>
		<!-- We need the Catalina jars for Tomcat -->
		<!--  * for other app servers - check the docs -->
		<fileset dir="${appserver.lib}">
			<include name="catalina-ant.jar" />
			<include name="tomcat-util.jar" />
			<include name="servlet-api.jar" />
			<include name="jsp-api.jar" />
			<include name="jasper.jar" />
		</fileset>
		<fileset dir="${appserver.home}/bin">
			<include name="tomcat-juli.jar" />
		</fileset>
	</path>
	
	<taskdef resource="catalina.tasks" onerror="failall"> 
			<classpath refid="catalina-ant-classpath" />
	</taskdef>

	<target name="deploy" 
		description="Install web application application to servlet container">

		<antcall target="tomcat.check-property">
			<param name="property" value="deploy.war" />
		</antcall>
		<antcall target="tomcat.check-property">
			<param name="property" value="manager.url"/>
		</antcall>
		<antcall target="tomcat.check-property">
			<param name="property" value="manager.username"/>
		</antcall>
	    <antcall target="tomcat.check-property">
				<param name="property" value="manager.password"/>
		</antcall>
		<echo message="deploying ${deploy.war} to ${appserver.home}"></echo>
		<deploy url="${manager.url}" 
			    username="${manager.username}" 
			    password="${manager.password}" 
			    path="/${app.name}" 
			    localWar="file://${basedir}/${deploy.war}">
		</deploy>

	</target>
	
	<target name="undeploy"
		description="undeploy application from servlet container">

		<antcall target="tomcat.check-property">
			<param name="property" value="manager.url"/>
		</antcall>
		<antcall target="tomcat.check-property">
			<param name="property" value="manager.username"/>
		</antcall>
	    <antcall target="tomcat.check-property">
				<param name="property" value="manager.password"/>
		</antcall>
		<echo message="undeploying ${app.name} from ${appserver.home}"></echo>
		<undeploy url="${manager.url}" 
			    username="${manager.username}" 
			    password="${manager.password}" 
			    path="/${app.name}">

		</undeploy>

	</target>


	<target name="check-property">
		<echo message="checking property ${property}"></echo>
		<condition property="exists">
			<isset property="${property}"/>
		</condition>
		<fail unless="exists" message="property ${property} has not been defined"/>
	</target>

</project>